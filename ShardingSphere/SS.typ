- 为什么需要分库分表
  - 单库单表的性能瓶颈
    - 单表数据量超过千万级时，查询性能显著下降：当单表数据量达到千万级甚至更高时，数据库的查询效率会急剧降低。以 MySQL 为例，随着数据量的增加，全表扫描的时间成本大幅上升，即使有索引，B + 树的层级也会增加，导致索引查找深度变大，查询耗时明显增加。比如一个电商系统的订单表，当数据量超过千万条后，简单的查询订单信息操作可能需要数秒甚至更长时间才能返回结果，严重影响用户体验。
    - 高并发场景下数据库连接数成为瓶颈：在高并发环境中，大量的请求同时访问数据库，数据库的连接数很快就会被耗尽。例如，一个热门的在线商城在促销活动期间，瞬间可能有数千个用户同时下单、查询订单等操作，而数据库的连接池大小有限，无法满足如此多的并发请求，导致新的请求被阻塞，系统响应迟缓甚至崩溃。
    - 硬件资源扩展成本高昂：为了提升单库单表的性能，不断升级硬件是一种方法，但这种方式不仅成本高昂，而且存在瓶颈。增加 CPU、内存、磁盘等硬件资源，不仅需要投入大量资金购买硬件设备，还需要考虑机房空间、电力消耗等问题。而且，单台服务器的硬件性能总有极限，当业务量持续增长，单纯依靠硬件升级无法根本解决问题。
  - 分库分表的核心价值
    - 水平扩展存储容量：通过分库分表，可以将数据分散存储到多个数据库实例和表中，突破了单库单表的存储限制，实现了存储容量的线性扩展。以一个社交平台为例，随着用户数量的不断增加，将用户信息表按照用户 ID 进行分库分表，每个库和表只存储一部分用户数据，从而可以轻松应对海量用户数据的存储需求。
    - 提升并发处理能力：分库分表后，多个数据库实例和表可以并行处理请求，大大提高了系统的并发处理能力。在高并发场景下，不同的请求可以被路由到不同的数据库实例和表上进行处理，避免了单个数据库的负载过高，减少了请求的等待时间，提升了系统的整体响应速度。
    - 实现负载均衡：将数据和请求均匀地分布到各个数据库实例和表上，实现了负载的均衡。这样可以充分利用各个数据库节点的资源，避免出现某个节点负载过重，而其他节点资源闲置的情况，提高了系统资源的利用率，保障了系统的稳定运行。
    - 增强系统可用性：当某个数据库实例或表出现故障时，其他的实例和表仍然可以正常工作，不会导致整个系统瘫痪。通过数据的冗余备份和故障转移机制，可以快速恢复故障节点的数据和服务，从而增强了系统的可用性和容错性，提高了系统的可靠性。
- 架构解析
  - Sharding-JDBC：这是一个轻量级的 Java 框架，它以 Jar 包的形式存在，直接嵌入到 Java 应用程序中，是增强版的 JDBC 驱动 。其核心优势在于零侵入式，应用程序可以像使用普通 JDBC 一样使用 Sharding-JDBC，对业务代码的侵入性极小，能够完全兼容 JDBC 和各种 ORM 框架，如 Hibernate、MyBatis 等。例如，在一个基于 Spring Boot 和 MyBatis 的电商项目中，只需简单地引入 Sharding-JDBC 的依赖，并进行相应的配置，就可以轻松实现分库分表和读写分离，而无需对原有的数据库访问代码进行大规模的修改。
  - Sharding-Proxy：Sharding-Proxy 是一个独立的数据库代理层，它对外暴露数据库协议，如 MySQL、PostgreSQL 协议，应用程序可以像连接普通数据库一样连接 Sharding-Proxy。它的主要特点是对异构语言的支持，无论应用程序使用何种编程语言开发，只要能连接数据库，就可以使用 Sharding-Proxy 实现分布式数据库的功能。对于一些使用 Python、Node.js 等语言开发的项目，通过连接 Sharding-Proxy，就能够享受到分库分表、读写分离等功能，而无需在应用程序中集成特定的分布式数据库框架。
  - Sharding-Sidecar：Sharding-Sidecar（现已重命名为 ShardingSphere-Agent）是面向云原生环境的解决方案，它基于 Kubernetes 等容器编排平台，以 Sidecar 模式与应用容器部署在一起。这种部署方式使得它能够充分利用容器化的优势，如资源隔离、弹性伸缩等，为云原生应用提供了便捷的分布式数据库治理能力。在一个基于 Kubernetes 的微服务架构中，每个微服务容器都可以部署一个 Sharding-Sidecar，实现对该微服务所使用数据库的分片和治理，同时通过 Kubernetes 的服务发现和负载均衡机制，实现对多个 Sharding-Sidecar 的统一管理和调度。